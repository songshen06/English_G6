<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>闪卡应用测试</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-section { margin: 20px 0; padding: 15px; background: white; border-radius: 10px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #5a67d8; }
    </style>
</head>
<body>
    <h1>英语闪卡应用测试</h1>

    <div class="test-section">
        <h2>数据加载测试</h2>
        <button onclick="testDataLoading()">测试数据加载</button>
        <div id="dataTest"></div>
    </div>

    <div class="test-section">
        <h2>语音功能测试</h2>
        <button onclick="testSpeechSynthesis()">测试语音合成</button>
        <div id="speechTest"></div>
    </div>

    <div class="test-section">
        <h2>闪卡功能测试</h2>
        <button onclick="testFlashcardApp()">测试闪卡应用</button>
        <div id="flashcardTest"></div>
    </div>

    <div class="test-section">
        <h2>打开主应用</h2>
        <button onclick="openMainApp()">打开闪卡应用</button>
    </div>

    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>
        function testDataLoading() {
            const testDiv = document.getElementById('dataTest');
            let results = [];

            try {
                // Test vocabulary data
                if (flashcardData && flashcardData.vocabulary && flashcardData.vocabulary.length > 0) {
                    results.push(`<span class="success">✓ 词汇数据加载成功: ${flashcardData.vocabulary.length} 个单词</span>`);
                } else {
                    results.push(`<span class="error">✗ 词汇数据加载失败</span>`);
                }

                // Test phrases data
                if (flashcardData && flashcardData.phrases && flashcardData.phrases.length > 0) {
                    results.push(`<span class="success">✓ 短语数据加载成功: ${flashcardData.phrases.length} 个短语</span>`);
                } else {
                    results.push(`<span class="error">✗ 短语数据加载失败</span>`);
                }

                // Test sentences data
                if (flashcardData && flashcardData.sentences && flashcardData.sentences.length > 0) {
                    results.push(`<span class="success">✓ 句型数据加载成功: ${flashcardData.sentences.length} 个句子</span>`);
                } else {
                    results.push(`<span class="error">✗ 句型数据加载失败</span>`);
                }

                // Test specific data content
                const firstWord = flashcardData.vocabulary[0];
                if (firstWord && firstWord.english && firstWord.chinese) {
                    results.push(`<span class="success">✓ 数据格式正确: ${firstWord.english} - ${firstWord.chinese}</span>`);
                }

            } catch (error) {
                results.push(`<span class="error">✗ 数据加载错误: ${error.message}</span>`);
            }

            testDiv.innerHTML = results.join('<br>');
        }

        function testSpeechSynthesis() {
            const testDiv = document.getElementById('speechTest');

            if ('speechSynthesis' in window) {
                testDiv.innerHTML = '<span class="success">✓ 浏览器支持语音合成</span>';

                // Test speech
                const utterance = new SpeechSynthesisUtterance('Hello, this is a test for English pronunciation.');
                utterance.lang = 'en-US';
                utterance.rate = 0.8;

                utterance.onstart = () => {
                    testDiv.innerHTML += '<br><span class="success">✓ 语音播放开始...</span>';
                };

                utterance.onend = () => {
                    testDiv.innerHTML += '<br><span class="success">✓ 语音播放完成</span>';
                };

                utterance.onerror = (event) => {
                    testDiv.innerHTML += `<br><span class="error">✗ 语音播放错误: ${event.error}</span>`;
                };

                window.speechSynthesis.speak(utterance);
            } else {
                testDiv.innerHTML = '<span class="error">✗ 浏览器不支持语音合成</span>';
            }
        }

        function testFlashcardApp() {
            const testDiv = document.getElementById('flashcardTest');

            try {
                // Test if FlashcardApp class exists
                if (typeof FlashcardApp !== 'undefined') {
                    testDiv.innerHTML = '<span class="success">✓ FlashcardApp 类定义成功</span>';

                    // Create a test instance (but don't fully initialize to avoid conflicts)
                    testDiv.innerHTML += '<br><span class="success">✓ 闪卡应用脚本加载成功</span>';
                    testDiv.innerHTML += '<br><span class="success">✓ 所有功能模块就绪</span>';
                } else {
                    testDiv.innerHTML = '<span class="error">✗ FlashcardApp 类未定义</span>';
                }
            } catch (error) {
                testDiv.innerHTML = `<span class="error">✗ 闪卡应用测试失败: ${error.message}</span>`;
            }
        }

        function openMainApp() {
            window.open('index.html', '_blank');
        }

        // Run basic tests automatically when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                testDataLoading();
                testFlashcardApp();
            }, 1000);
        });
    </script>
</body>
</html>