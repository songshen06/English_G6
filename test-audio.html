<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="test.css">
    <style>
        .audio-test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }
        .test-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        .audio-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
            margin: 5px;
        }
        .audio-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #38a169, #2f855a);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }
        .audio-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        .word-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .test-word {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
            position: relative;
        }
        .test-word:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }
        .test-word::after {
            content: 'ğŸ”Š';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .test-word:hover::after {
            opacity: 0.6;
        }
        .status-display {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        .log-entry.info {
            background: #bee3f8;
            color: #2c5282;
        }
        .log-entry.success {
            background: #c6f6d5;
            color: #22543d;
        }
        .log-entry.error {
            background: #fed7d7;
            color: #742a2a;
        }
    </style>
</head>
<body>
    <div class="audio-test-container">
        <header class="test-header">
            <h1>ğŸ”Š éŸ³é¢‘åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•è¯­éŸ³åˆæˆå’ŒéŸ³é¢‘æ’­æ”¾åŠŸèƒ½</p>
        </header>

        <div class="test-section">
            <h2>æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥</h2>
            <div id="compatibility-check"></div>
            <button class="audio-btn" onclick="checkCompatibility()">æ£€æŸ¥å…¼å®¹æ€§</button>
        </div>

        <div class="test-section">
            <h2>å¥å­éŸ³é¢‘æµ‹è¯•</h2>
            <p>ç‚¹å‡»æŒ‰é’®æ’­æ”¾å®Œæ•´å¥å­çš„éŸ³é¢‘ï¼š</p>
            <div style="margin-top: 15px;">
                <button class="audio-btn" id="sentenceBtn1" onclick="testSentence('Hello, how are you today?')">
                    ğŸ”Š æ’­æ”¾å¥å­ 1
                </button>
                <button class="audio-btn" id="sentenceBtn2" onclick="testSentence('What time is it now?')">
                    ğŸ”Š æ’­æ”¾å¥å­ 2
                </button>
                <button class="audio-btn" id="sentenceBtn3" onclick="testSentence('I love learning English.')">
                    ğŸ”Š æ’­æ”¾å¥å­ 3
                </button>
            </div>
        </div>

        <div class="test-section">
            <h2>å•è¯éŸ³é¢‘æµ‹è¯•</h2>
            <p>ç‚¹å‡»å•è¯å—æ’­æ”¾å•è¯å‘éŸ³ï¼š</p>
            <div class="word-grid">
                <div class="test-word" onclick="testWord('Hello')">Hello</div>
                <div class="test-word" onclick="testWord('World')">World</div>
                <div class="test-word" onclick="testWord('English')">English</div>
                <div class="test-word" onclick="testWord('Learning')">Learning</div>
                <div class="test-word" onclick="testWord('Beautiful')">Beautiful</div>
                <div class="test-word" onclick="testWord('Wonderful')">Wonderful</div>
                <div class="test-word" onclick="testWord('Amazing')">Amazing</div>
                <div class="test-word" onclick="testWord('Excellent')">Excellent</div>
            </div>
        </div>

        <div class="test-section">
            <h2>éŸ³é¢‘é˜Ÿåˆ—æµ‹è¯•</h2>
            <p>æµ‹è¯•å¤šä¸ªéŸ³é¢‘çš„é˜Ÿåˆ—æ’­æ”¾ï¼š</p>
            <button class="audio-btn" onclick="testAudioQueue()">
                ğŸµ æ’­æ”¾å•è¯åºåˆ—
            </button>
            <button class="audio-btn" onclick="clearQueue()">
                ğŸ—‘ï¸ æ¸…ç©ºé˜Ÿåˆ—
            </button>
        </div>

        <div class="test-section">
            <h2>çŠ¶æ€æ—¥å¿—</h2>
            <div class="status-display" id="statusLog"></div>
            <button class="audio-btn" onclick="clearLog()">
                ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—
            </button>
        </div>

        <div class="test-section">
            <h2>å®Œæ•´æµ‹è¯•</h2>
            <p>è¿è¡Œå®Œæ•´çš„éŸ³é¢‘åŠŸèƒ½æµ‹è¯•ï¼š</p>
            <button class="audio-btn" onclick="runFullTest()">
                â–¶ï¸ è¿è¡Œå®Œæ•´æµ‹è¯•
            </button>
            <div style="margin-top: 15px;">
                <a href="test.html" class="audio-btn" style="text-decoration: none; display: inline-block;">
                    ğŸ“š è¿›å…¥æµ‹è¯•ç³»ç»Ÿ
                </a>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // æ¨¡æ‹Ÿæµ‹è¯•ç³»ç»Ÿçš„éŸ³é¢‘åŠŸèƒ½
        class AudioTestSystem {
            constructor() {
                this.audioQueue = [];
                this.isSpeaking = false;
            }

            playSentenceAudio(sentence, buttonId) {
                this.log('å¼€å§‹æ’­æ”¾å¥å­: ' + sentence, 'info');

                if ('speechSynthesis' in window) {
                    this.addToAudioQueue({
                        type: 'sentence',
                        text: sentence,
                        buttonId: buttonId,
                        rate: 0.9
                    });
                    this.processAudioQueue();
                } else {
                    this.log('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ', 'error');
                    this.updateAudioButtonState(buttonId, 'ğŸ”‡ ä¸æ”¯æŒéŸ³é¢‘', true, 'error');
                }
            }

            playWordAudio(word) {
                this.log('å¼€å§‹æ’­æ”¾å•è¯: ' + word, 'info');

                if ('speechSynthesis' in window && word) {
                    this.addToAudioQueue({
                        type: 'word',
                        text: word,
                        rate: 0.8
                    });
                    this.processAudioQueue();
                } else {
                    this.log('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ', 'error');
                }
            }

            addToAudioQueue(audioItem) {
                this.audioQueue.push(audioItem);
                if (this.audioQueue.length > 5) {
                    this.audioQueue = this.audioQueue.slice(-5);
                }
                this.log('æ·»åŠ åˆ°éŸ³é¢‘é˜Ÿåˆ—: ' + audioItem.text + ' (é˜Ÿåˆ—é•¿åº¦: ' + this.audioQueue.length + ')', 'info');
            }

            processAudioQueue() {
                if (this.isSpeaking || this.audioQueue.length === 0) {
                    return;
                }

                this.isSpeaking = true;
                const audioItem = this.audioQueue.shift();

                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(audioItem.text);
                utterance.lang = 'en-US';
                utterance.rate = audioItem.rate;
                utterance.pitch = 1;
                utterance.volume = 1;

                if (audioItem.buttonId) {
                    this.updateAudioButtonState(audioItem.buttonId, 'ğŸ”Š æ’­æ”¾ä¸­...', true);
                }

                utterance.onend = () => {
                    this.isSpeaking = false;
                    this.log('æ’­æ”¾å®Œæˆ: ' + audioItem.text, 'success');

                    if (audioItem.buttonId) {
                        this.updateAudioButtonState(audioItem.buttonId, 'ğŸ”Š æ’­æ”¾éŸ³é¢‘', false);
                    }

                    setTimeout(() => {
                        this.processAudioQueue();
                    }, 200);
                };

                utterance.onerror = (event) => {
                    this.log('æ’­æ”¾é”™è¯¯: ' + audioItem.text + ' - ' + event.error, 'error');
                    this.isSpeaking = false;

                    if (audioItem.buttonId) {
                        this.updateAudioButtonState(audioItem.buttonId, 'ğŸ”Š æ’­æ”¾éŸ³é¢‘', false);
                    }

                    setTimeout(() => {
                        this.processAudioQueue();
                    }, 200);
                };

                window.speechSynthesis.speak(utterance);
                this.log('æ­£åœ¨æ’­æ”¾: ' + audioItem.text, 'info');
            }

            updateAudioButtonState(buttonId, text, disabled, state = 'normal') {
                const audioBtn = document.getElementById(buttonId);
                if (audioBtn) {
                    audioBtn.textContent = text;
                    audioBtn.disabled = disabled;
                    if (state === 'error') {
                        audioBtn.style.background = 'linear-gradient(135deg, #e53e3e, #c53030)';
                    }
                }
            }

            clearAudioQueue() {
                this.audioQueue = [];
                window.speechSynthesis.cancel();
                this.isSpeaking = false;
                this.log('éŸ³é¢‘é˜Ÿåˆ—å·²æ¸…ç©º', 'info');
            }

            log(message, type = 'info') {
                const logContainer = document.getElementById('statusLog');
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry ' + type;
                const timestamp = new Date().toLocaleTimeString();
                logEntry.textContent = `[${timestamp}] ${message}`;
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        // åˆ›å»ºéŸ³é¢‘æµ‹è¯•ç³»ç»Ÿå®ä¾‹
        const audioTest = new AudioTestSystem();

        // æµ‹è¯•å‡½æ•°
        function testSentence(sentence) {
            audioTest.playSentenceAudio(sentence, 'sentenceBtn1');
        }

        function testWord(word) {
            audioTest.playWordAudio(word);
        }

        function testAudioQueue() {
            const words = ['Hello', 'World', 'This', 'Is', 'A', 'Test'];
            words.forEach((word, index) => {
                setTimeout(() => {
                    audioTest.playWordAudio(word);
                }, index * 1000);
            });
        }

        function clearQueue() {
            audioTest.clearAudioQueue();
        }

        function clearLog() {
            document.getElementById('statusLog').innerHTML = '';
        }

        function checkCompatibility() {
            const container = document.getElementById('compatibility-check');
            let html = '<ul style="list-style: none; padding: 0;">';

            if ('speechSynthesis' in window) {
                html += '<li style="color: green;">âœ… è¯­éŸ³åˆæˆæ”¯æŒ</li>';

                // è·å–å¯ç”¨çš„è¯­éŸ³
                const voices = speechSynthesis.getVoices();
                const englishVoices = voices.filter(voice => voice.lang.startsWith('en'));

                if (englishVoices.length > 0) {
                    html += `<li style="color: green;">âœ… æ‰¾åˆ° ${englishVoices.length} ä¸ªè‹±è¯­è¯­éŸ³</li>`;
                } else {
                    html += '<li style="color: orange;">âš ï¸ æœªæ‰¾åˆ°è‹±è¯­è¯­éŸ³</li>';
                }
            } else {
                html += '<li style="color: red;">âŒ è¯­éŸ³åˆæˆä¸æ”¯æŒ</li>';
            }

            if ('draggable' in document.createElement('div')) {
                html += '<li style="color: green;">âœ… HTML5æ‹–æ‹½æ”¯æŒ</li>';
            } else {
                html += '<li style="color: red;">âŒ HTML5æ‹–æ‹½ä¸æ”¯æŒ</li>';
            }

            html += '</ul>';
            container.innerHTML = html;
        }

        function runFullTest() {
            audioTest.log('=== å¼€å§‹å®Œæ•´éŸ³é¢‘æµ‹è¯• ===', 'info');

            // æµ‹è¯•å¥å­éŸ³é¢‘
            setTimeout(() => {
                testSentence('Hello, this is a test of the audio system.');
            }, 1000);

            // æµ‹è¯•å•è¯éŸ³é¢‘
            setTimeout(() => {
                testWord('Beautiful');
            }, 4000);

            // æµ‹è¯•éŸ³é¢‘é˜Ÿåˆ—
            setTimeout(() => {
                testAudioQueue();
            }, 6000);

            // å®Œæˆæµ‹è¯•
            setTimeout(() => {
                audioTest.log('=== å®Œæ•´éŸ³é¢‘æµ‹è¯•å®Œæˆ ===', 'success');
            }, 12000);
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥å…¼å®¹æ€§
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkCompatibility, 500);

            // ç¡®ä¿è¯­éŸ³åˆ—è¡¨å·²åŠ è½½
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = checkCompatibility;
            }
        });
    </script>
</body>
</html>